\makeatletter
\usepackage{latexsym}
\def\qedmath{%
   \relax\ifmmode
      \@badmath
   \else
      \begin{trivlist}%
      \@beginparpenalty\predisplaypenalty
      \@endparpenalty\postdisplaypenalty
      \item[]\leavevmode
      \hbox to\linewidth\bgroup\relax\hfil$\displaystyle
      \bgroup
   \fi
}
\def\endqedmath{%
   \relax\ifmmode
      \egroup $\hfil \egroup\\[-\baselineskip]
      \hbox{}\hfill\llap{\phantom{0}\qed}
      \end{trivlist}
   \else
      \@badmath
   \fi
}
\def\qedflmath{\relax \ifmmode \@badmath
  \else\begin{trivlist}%
     \@beginparpenalty\predisplaypenalty
     \@endparpenalty\postdisplaypenalty
    \item[]\leavevmode \hb@xt@\linewidth\bgroup $\m@th\displaystyle %$
    \hskip\mathindent\bgroup
  \fi}
\def\endqedflmath{\relax\ifmmode
    \egroup $% $
    \egroup \\[-\baselineskip]\hskip\linewidth\llap{\qed}
    \end{trivlist}%
  \else \@badmath
  \fi}
\makeatother


\newcommand{\witharity}[2]{#1^{(#2)}}
\newcommand{\todo}[1]{\textcolor{red}{\textbf{[TODO: #1]}}}
%\newcommand{\todo}[1]{}
\newcommand{\kztk}[1]{\textcolor{blue}{[kztk: #1]}}

\newcommand{\mi}[1]{\ensuremath{\mathit{#1}}}
\newcommand{\ms}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\mt}[1]{\ensuremath{\mathtt{#1}}}

\newcommand{\eg}{{\it e.g.}\xspace}
\newcommand{\ie}{{\it i.e.}\xspace}
\newcommand{\cf}{{\it cf.}\xspace}
\newcommand{\etal}{{\it et al.}\xspace}
\newcommand{\wrt}{{\it w.r.t.}\xspace}

\newenvironment{tarray}[2][c]{%
\settowidth{\dimen1}{${} = {}$}%
\setlength{\arraycolsep}{0.125\dimen1}
\hspace{-0.125\dimen1}\array[#1]{#2}\relax
}
{%
\endarray\hspace{-0.125\dimen1}
}
\newcommand{\bb}{\tarray{lllll}}
\newcommand{\bbt}{\tarray[t]{lllll}}
\newcommand{\bbb}{\tarray[b]{lllll}}
\newcommand{\ee}{\endtarray}

\newcommand{\from}{\leftarrow}

\newenvironment{cond}{\left\{\array{l@{\quad}l}}{\endarray\right.}


\newcommand{\key}[1]{\ensuremath{\mathbf{#1}}} % keyword


\newcommand{\dontcare}{\underline{\phantom{v}}} 



\makeatletter
\newcommand{\set}{\@ifstar\mysetStar\mysetNoStar}
\newcommand{\mysetStar}[1]{\{#1\}}
\newcommand{\mysetNoStar}[1]{\left\{#1\right\}}
\makeatother


\newcommand{\sem}[1]{{\llbracket #1 \rrbracket}}


\newcommand{\tuple}[1]{\langle #1 \rangle}


%\newcommand{\CHOICE}{\mathbin{\parallel}}
\newcommand{\CHOICE}{\mathbin{%
%    \scalebox{1}[0.8]{\ooalign{{$\hss\langle~\hss$}\crcr{$\hss~|\hss$}}}%
% \ooalign{{$\hss\,/\hss$}\crcr{$\hss/\,$}}
\mathbin{\scalebox{0.9}{\texttt{<\hspace{-1pt}+}}}
}}

\newcommand{\wadler}[1]{\text{\sffamily\slshape #1}}
%\newcommand{\NDCHOICE}{\mathbin{\parallel}}
\newcommand{\NDCHOICE}{\mathbin{?}}
\newcommand{\STR}[1]{\texttt{"#1"}}
%\newcommand{\CAT}{\mathbin{\diamond}}
\newcommand{\CAT}{\mathbin{\scalebox{0.9}{\texttt{<\hspace{-0.3pt}>}}}}
\newcommand{\CATs}{\mathbin{\ooalign{{$\hss\diamond\hss$}\crcr{$\hss*\hss$}}}}
\newcommand{\SEPs}{\mathbin{\texttt{\$\$}}}
\newcommand{\EMPTY}{\ms{empty}}
\newcommand{\LINE}{\wadler{line}}
\newcommand{\GROUP}{\wadler{group}}
\newcommand{\NEST}{\wadler{nest}}
\newcommand{\TEXT}{\wadler{text}}
\newcommand{\TXT}[1]{\TEXT\phantom{l}\texttt{"#1"}}
%\newcommand{\TEXTAS}[2]{\TEXT\:(#1 \mathrel{\key{as}} #2)}
\newcommand{\TEXTAS}[2]{\TEXT\phantom{l}({#1}\mathbin{\key{as}}{#2})}
%\newcommand{\REIFY}{\ms{reify}}
\newcommand{\PARENS}[1]{\TXT{(}\CAT#1\CAT\TXT{)}}
%\newcommand{\APPEND}{\mathbin{+\!\!+}}
\newcommand{\Q}[1]{\texttt{"#1"}}

\newcommand{\IF}[3]{\key{if}\;#1\;\key{then}\;#2\;\key{else}\;#3}

\newcommand{\COMMENT}[1]{\mbox{\texttt{\lb-} {#1} \texttt{-\rb}}}

\newcommand{\bs}{\char`\\} %}\textbackslash}
\newcommand{\lb}{\char'173}
\newcommand{\rb}{\char'175}
%\newcommand{\us}{\hspace{-1pt}\text{\textunderscore}}
\newcommand{\us}{\hspace{-1pt}\text{\rule{3.5pt}{.5pt}}}
\newcommand{\hsEq}{\mathrel{\texttt{==}}}

\newcommand{\n}{\bs{}n}

\newcommand{\tAST}{\ms{AST}}
\newcommand{\tDoc}{\ms{Doc}}
\newcommand{\tStatic}{\ms{St}}

\newcommand{\Ty}[3]{#1 \vdash #2 : #3}
\newcommand{\TyD}[2]{#1 \vdash #2}
%\newcommand{\TyP}[3]{\vdash #1 : #2 \triangleright #3}
\newcommand{\TyP}[3]{#3 \vdash #1 : #2}

%\theoremstyle{definition}
%\newtheorem{example}{Example}

\newcommand{\figref}[1]{Fig.\;\ref{#1}}

\newcommand{\EVAL}[3]{ {#1} \vdash {#2} \Downarrow {#3}}
\newcommand{\DEVAL}[3]{ {#1} \vdash {#2} \Downarrow_\mathrm{ND} {#3}}

\newcommand{\dom}{\mathsf{dom}}
\newcommand{\fv}{\mathsf{fv}}

\newcommand{\drive}[2]{\mathcal{D}\sem{#1}_{#2}}

\newcommand{\seq}[1]{\widetilde{#1}}

%\newcommand{\RSET}[1]{\sem{#1}_\mathrm{ND}}
\newcommand{\PARSE}[1]{\sem{#1}_\mathrm{P}}
